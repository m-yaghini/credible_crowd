<!DOCTYPE html>
<html lang="en">
<head>
<title>Is this news True or Fake?</title>
<!-- JS Libraries -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.8.9/jquery.csv.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.10/lodash.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.17.0/dist/jquery.validate.js"></script>
<script src = "https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.10.0/js/md5.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/regular.css" integrity="sha384-EWu6DiBz01XlR6XGsVuabDMbDN6RT8cwNoY+3tIH+6pUCfaNldJYJQfQlbEIWLyA" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/fontawesome.css" integrity="sha384-GVa9GOgVQgOk+TNYXu7S/InPTfSDTtBalSgkgqQ7sCik56N9ztlkoTr2f/T44oKV" crossorigin="anonymous">



<!-- Responsive Designs -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">


<!-- CSS Styles -->
<style>

#bonus  {
    font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
    border-collapse: collapse;
    width: 100%;
}

#bonus td, #bonus th {
    border: 1px solid #ddd;
    padding: 8px;
}

#bonus tr:nth-child(even){background-color: #f2f2f2;}

#bonus tr:hover {background-color: #ddd;}

#bonus th {
    padding-top: 12px;
    padding-bottom: 12px;
    text-align: left;
    background-color: #005493;
    color: white;
}



#bonus2  {
    font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
    border-collapse: collapse;
    width: 100%;
}

#bonus2 td, #bonus2 th {
    border: 1px solid #ddd;
    padding: 8px;
}

#bonus2 tr:nth-child(even){background-color: #f2f2f2;}

#bonus2 tr:hover {background-color: #ddd;}

#bonus2 th {
    padding-top: 12px;
    padding-bottom: 12px;
    text-align: left;
    background-color: #005493;
    color: white;
}



.trialDiv {
  border: 2px solid gray;
  padding: 20px;
  width: 90%;
  max-width: 960px;
  margin: 0 auto;
  display: none;
}

.topImg{
  max-width:100%;
  height:auto;
}


.AnswerBox{
  width: 70px;
  font-size: 12pt;
}

.newsText{
  text-align: justify;
  white-space: pre-wrap;
}

.QuestionBox{

}

.NewsTextBox {
	float:right;
	overflow-y: auto;
	padding: 10px;
	height: calc(95vh - 830px); 
	overflow: -moz-scrollbars-vertical;
}


.nextQuestionButton{
  width: 70px;
  height:  30px;
  font-size: 12pt;
}

.Header{
	display: flex;
  	justify-content: space-between;
  	font-size: 10pt;
  	color:gray; 
  	text-decoration: none;
}

#submitButton {
  display: none;
}

#instructions {
  width: 90%;
  max-width: 960px;
  margin: 0 auto;
  text-align: center;
  margin-top: 100px;
}

#startExperiment {
  color: rgb(200,200,200);
  text-decoration: none;
}

#startExperiment:hover {
  color: white;
}

#startExperimentButton {
  width: 200px;
  text-align: center;
  border: 4px outset gray;
  background: gray;
  padding: 5px;
  margin: 0 auto;
}

#helpInstructions {
  width: 90%;
  max-width: 960px;
  margin: 0 auto;
  text-align: center;
  margin-top: 100px;
  display: none;
}

#thankYou {
  width: 90%;
  max-width: 960px;
  margin: 0 auto;
  text-align: center;
  margin-top: 100px;
  display: none;
}

#goBackHeader {
  text-align: right;
  font-size: 10pt;
}

body {
  font-family: Arial, Helvetica;
  font-size: 13pt;
}

</style>
</head>




<!-- Document Begins -->
<body>
<input type="hidden" name="_">
<div id="instructions" style="margin: 40px auto;">
<p style="font-size: 32pt"> Is this news <b>real</b> or <b> fake</b> ? 
</p>

<div style="text-align: left;">
 Please read the news pieces that follow, and answer these questions: 
  <ol>
  <li>If you think the news piece is <b>objectively fake</b> (it contains <b>mainly misinformation</b>) or not,</li>
  <li>Your confidence in your response,</li>
  <li>Your estimation of others' answers to the first question.<br/>(Note: The responders are all American MTurk workers.) </li>
</ol>
You can <b>double</b> or even <b>triple</b> your earnings with bonuses.
</div>


<h2> Things to know </h2>
<div style="text-align: left;">
<ul>
  <li>This experiment is not optimized for phones. If possible, please use a <b>desktop computer</b>.
  <li>News pieces vary in length but the whole experiment is designed to take roughly 10 minutes. Do not rush; you are given 6 hours to finish the task.</li>
  <li>Your answers will be accepted (in 1 hour) and you will be paid $2 for your participation regardless of your answers, so tell us your honest opinion.</li>
  <li>Your expertise/knowledge will be awarded in the form of additional bonuses.</li>
</ul>
</div>


<h2> Bonuses </h2>
There are two bonuses that you can collect in addition to your flat participation fee.

<h3> Accuracy Bonus </h3>
<div style="text-align: left;">
Based on your answer to Questions 1 and 2 we calculate an <i>accuracy</i> score for you according to the following table, and calculate a sum of scores. The top 20% of MTurk workers who have the highest sum of scores will be awarded a bonus of $2. 
<p style='margin-bottom: 0.5cm;'> </p>

<table id="bonus">
  <tr>
    <th>Your confidence</th>
    <th>Your score if you are correct</th>
    <th>Your score if you are wrong</th>
  </tr>
  <tr>
    <td>50%</td>
    <td>0</td>
    <td>0</td>
  </tr>
  <tr>
    <td>60%</td>
    <td>9</td>
    <td>-11</td>

  </tr>
  <tr>
    <td>70%</td>
    <td>16</td>
    <td>-24</td>
  </tr>
  <tr>
    <td>80%</td>
    <td>21</td>
    <td>-39</td>
  </tr>
  <tr>
    <td>90%</td>
    <td>24</td>
    <td>-56</td>
  </tr>
  <tr>
    <td>100%</td>
    <td>25</td>
    <td>-75</td>
  </tr>
</table>


  <ul>
  <li>The more certain you claim to be, the more points you can win.</li>
  <li>As you approach 100%, the penalty for being incorrect climbs much faster than the gains for being correct.</li>
  <li>In general, you will score the most points if the numbers correspond to your true levels of confidence. <i> Expressing too much confidence is a common mistake in this game. </i> </li>
</ul>
</div>

<h3>Estimation Bonus</h3>
<div style="text-align: left;">
You will be rewarded an additional $2 bonus if you can make a good estimation of others' responses (Question 3). Note that the experiment is only open to American workers on MTurk. The bonus goes to the top 20% of MTurk workers with the best estimation.<p style='margin-bottom: 0.5cm;'> </p>
</div>

<div id="startExperimentButton">
<a href="#" id="startExperiment">Start the survey</a>
</div>

</div>

<div id="topDiv"></div>
<div id="divTrials"> </div>


<div id="helpInstructions" style="margin: 40px auto;">
	<div id="goBackHeader"> <a href="javascript:hideHelp()" style="color:gray; text-decoration: none;"><i class="far fa-arrow-alt-circle-left"></i> Go Back</a></div>
	<p style="font-size: 32pt"> Is this news <b>real</b> or <b> fake</b> ? 
</p>

<div style="text-align: left;">
 Please read the news pieces that follow, and answer these questions: 
  <ol>
  <li>If you think the news piece is <b>objectively fake</b> (it contains <b>mainly misinformation</b>) or not,</li>
  <li>Your confidence in your response,</li>
  <li>Your estimation of others' answers to the first question.<br/>(Note: The responders are all American MTurk workers.) </li>
</ol>
You can <b>double</b> or even <b>triple</b> your earnings with bonuses.
</div>


<h2> Things to know </h2>
<div style="text-align: left;">
<ul>
  <li>This experiment is not optimized for phones. If possible, please use a <b>desktop computer</b>.
  <li>News pieces vary in length but the whole experiment is designed to take roughly 10 minutes. Do not rush; you are given 6 hours to finish the task.</li>
  <li>Your answers will be accepted (in 1 hour) and you will be paid $2 for your participation regardless of your answers, so tell us your honest opinion.</li>
  <li>Your expertise/knowledge will be awarded in the form of additional bonuses.</li>
</ul>
</div>


<h2> Bonuses </h2>
There are two bonuses that you can collect in addition to your flat participation fee.

<h3> Accuracy Bonus </h3>
<div style="text-align: left;">
Based on your answer to Questions 1 and 2 we calculate an <i>accuracy</i> score for you according to the following table, and calculate a sum of scores. The top 20% of MTurk workers who have the highest sum of scores will be awarded a bonus of $2. 
<p style='margin-bottom: 0.5cm;'> </p>

<table id="bonus2">
  <tr>
    <th>Your confidence</th>
    <th>Your score if you are correct</th>
    <th>Your score if you are wrong</th>
  </tr>
  <tr>
    <td>50%</td>
    <td>0</td>
    <td>0</td>
  </tr>
  <tr>
    <td>60%</td>
    <td>9</td>
    <td>-11</td>

  </tr>
  <tr>
    <td>70%</td>
    <td>16</td>
    <td>-24</td>
  </tr>
  <tr>
    <td>80%</td>
    <td>21</td>
    <td>-39</td>
  </tr>
  <tr>
    <td>90%</td>
    <td>24</td>
    <td>-56</td>
  </tr>
  <tr>
    <td>100%</td>
    <td>25</td>
    <td>-75</td>
  </tr>
</table>


  <ul>
  <li>The more certain you claim to be, the more points you can win.</li>
  <li>As you approach 100%, the penalty for being incorrect climbs much faster than the gains for being correct.</li>
  <li>In general, you will score the most points if the numbers correspond to your true levels of confidence. <i> Expressing too much confidence is a common mistake in this game. </i> </li>
</ul>
</div>

<h3>Estimation Bonus</h3>
<div style="text-align: left;">
  You will be rewarded an additional $2 bonus if you can make a good estimation of others' responses (Question 3). Note that the experiment is only open to American workers on MTurk. The bonus goes to the top 20% of MTurk workers with the best estimation.
<p style='margin-bottom: 0.5cm;'> </p>
</div>

</div>


<div id="thankYou">
<h1> Thank you!</h1>
<b> Don't forget to submit your HIT! Please click on the 'Submit' button.</b>
<br><br>
We thank you for your participation in our experiment. Your answers will be accepted. Once we have collected the data from all participants, 
we will calculate accuracy and estimation scores and give out the bonuses via Mechanical Turk using your worker ID.
</div>



<!-- Main JS Script -->
<script>
// var trialOrder = [1, 2, 3, 4];
var DEBUG = false;
var nTrials = 11;
var trialOrder = shuffle(_.range(nTrials));
var curTrial = 0;
var startTrialTime;

function checkAnswers(){
  var _questionReal = "#questionRealID"+trialOrder[curTrial]
  var _questionFake = "#questionFakeID"+trialOrder[curTrial]
  var _confAnswer = "#confAnswerID"+trialOrder[curTrial]
  var _estimAnswer = "#estimAnswerID"+trialOrder[curTrial]
  var _validAnswer = "#validAnswerID"+trialOrder[curTrial]

  if( !($(_questionReal).is(':checked') | $(_questionFake).is(':checked'))) {
    alert("Please select either False or Real for Question 1.");
    return false;
  }
  else if (!((parseInt($(_confAnswer).val()) >= 50) && (parseInt($(_confAnswer).val()) <= 100))) {
    alert('Your answer to Question 2 needs to between 50% ("Not Confident at all") and 100% ("Absolutely Certain").');
    return false;
  }
  else if (!((parseInt($(_estimAnswer).val()) >= 0) && (parseInt($(_estimAnswer).val()) <= 100))) {
    alert('Your answer to Question 3 needs to between 0% ("No one believes the answer to Question 1 is \'real\'.") and 100% ("Everyone believes so.").');
    return false;
  }
  else if (!(md5($(_validAnswer).val().toLowerCase()) === news[trialOrder[curTrial]].honeypot_answers_hashed)){
    alert("Please validate your answer to Question 4. Maybe you have a spelling error? The answer is not case-sensitive.");
    return false;
  }
  else {
    return true;
  }


}

function buttonClicked() {
   
   // Debug:
  if(DEBUG){
	   console.log(curTrial + "- #" + news[trialOrder[curTrial]].orig_index + " => "+ trialOrder[curTrial] + ", F:" +news[trialOrder[curTrial]].fake + "\n" + news[trialOrder[curTrial]].title)
	}

  if (checkAnswers()) {
    document.getElementById('topDiv').scrollIntoView();
    var curTime = new Date();
    var rt = curTime - startTrialTime;
    $('#reactionTimeID' + trialOrder[curTrial]).val(rt);
	// Record of the start of the next trial
    if(curTrial < (nTrials - 1)) {
		$('#startTimeID' + trialOrder[curTrial+1]).val(new Date().getTime());
	  }
    $('#trial' + trialOrder[curTrial]).hide();
    curTrial++;
    if (curTrial >= nTrials) {
      $('#thankYou').show();
      $('#submitButton').show();
    } else {
      $('#trial' + trialOrder[curTrial]).show();
      startTrialTime = new Date();
    }

  }
}

function showHelp() {
	$('#trial' + trialOrder[curTrial]).hide();
	$('#helpInstructions').show()
}

function hideHelp() {
	$('#helpInstructions').hide()
	$('#trial' + trialOrder[curTrial]).show();
}



function showFirstTrial() {
  document.getElementById('topDiv').scrollIntoView();
  $('#trial' + trialOrder[0]).show();
  startTrialTime = new Date();
  // Set the start time of the first trial
  $('#startTimeID' + trialOrder[0]).val(new Date().getTime());
  $('#instructions').hide();
}

/* Fisher-Yates shuffle */
function shuffle(o){
    for(var j, x, i = o.length; i; j = Math.floor(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
    return o;
}

var news
function readTextFile(file)
{
    var rawFile = new XMLHttpRequest();
    rawFile.open("GET", file, false);
    rawFile.onreadystatechange = function ()
    {
        if(rawFile.readyState === 4)
        {
            if(rawFile.status === 200 || rawFile.status == 0)
            {
                var allText = rawFile.responseText;
                news = $.csv.toObjects(allText)
            }
        }
    }
    rawFile.send(null);
}


function addLogEvent(j){
	$('#questionRealID' + trialOrder[j]).click( function() {
	  		$('#realFakeTimeID' + trialOrder[j]).val(new Date().getTime());});
	$('#questionFakeID' + trialOrder[j]).click( function() {
	  		$('#realFakeTimeID' + trialOrder[j]).val(new Date().getTime());});

	$('#confAnswerID' + trialOrder[j]).focus( function() {
			$('#confidenceTimeID' + trialOrder[j]).val(new Date().getTime());});

	$('#estimAnswerID' + trialOrder[j]).focus( function() {
			$('#estimationTimeID' + trialOrder[j]).val(new Date().getTime());});	  

	$('#validAnswerID' + trialOrder[j]).focus( function() {
			$('#validationTimeID' + trialOrder[j]).val(new Date().getTime());});

}

String.prototype.format = String.prototype.f = function() {
    var s = this,
        k = arguments.length;

    while (k--) {
        s = s.replace(new RegExp('\\{' + k + '\\}', 'gm'), arguments[k]);
    }
    return s;
};


$(document).ready(function() {
   /* Load the data */
  readTextFile('https://s3-us-west-1.amazonaws.com/myaghini/select_news.csv');
  // readTextFile('./data/select_news.csv')

  for(var i = 0; i < nTrials; i++ ) {
    $("#divTrials").append(
      $('<div>', {class:"trialDiv", id:"trial" + trialOrder[i]}).append(
          $("<p>", {style:""}).append(
            // $("<img>", {class:"topImg", src:news[trialOrder[i]].top_img}),
          ),
          $('<div class="Header" align="right"> <a align="left" class="Header">Question {0}/{1}'.f(i+1, nTrials) 
          					+  '</a> <a href="javascript:showHelp()" style="color:gray; text-decoration: none;"><i class="far fa-question-circle"></i>  Show Instructions</a></div>'),
          $("<h2>", {text:news[trialOrder[i]].title}),
          // $("<div>", {class:"NewsTextBox"}).append(
      	  $("<p>", {text:news[trialOrder[i]].text, class:"newsText", style:"overflow: auto;"}),
          	  // ),
          // $("<p>", {style: 'margin-bottom: 1cm;'}),

          // $('<div>', {class:"QuestionBox"}).append(
          $('<h3> 1. Is this news piece real or fake? </h3>'),
          $('<p> <input type="radio" value="1"   name="opinion'+ trialOrder[i] + '" id="questionRealID' + trialOrder[i] +'"> Real </input> </p>'),
          $('<p> <input type="radio" value="-1"  name="opinion'+ trialOrder[i] + '" id="questionFakeID' + trialOrder[i] + '"> Fake </input> </p>'),

          // $('<h3> 2. How much would you bet in favor of your answer? </h3>'),
          // $('<p> <input type="text" value=50 class="AnswerBox" id="confAnswerID' + trialOrder[i] +'" name="confAnswer'+ trialOrder[i] + '"></input> : 1 in favor <br/> <br/> For example, a 50:1 bet in favor of "Real" means that you think the news piece is 50 times more likely to be real than fake. </p>'),          

          $('<h3> 2. How confident are you in your answer? </h3>'),
          $('<p> <input type="text" value="" class="AnswerBox" id="confAnswerID' + trialOrder[i] +'" name="confAnswer'+ trialOrder[i] + '"></input> %<br/> </p>'),

          $('<h3> 3. What percentage of other American MechanicalTurk respondents do you think would answer "Real" to the first question? </h3>'),
          $('<p> <input type="text" value="" class="AnswerBox" id="estimAnswerID' + trialOrder[i] +'" name="estimAnswer'+ trialOrder[i] + '"></input> % of respondents would say that this news article is real. </p>'),

          $('<h3> 4. Show us that you have read the news.</h3><p style="margin-top: 0cm;"> Show us by typing the name of the <b>fruit</b> that you encountered in an out-of-context sentence, like "Lemon is good for a cold."</p>'),
          $('<input type="text" value="" class="AnswerBox" id="validAnswerID' + trialOrder[i] +'" name="validAnswer'+ trialOrder[i] + '"></input></p>'),
	          // ),
          // Data Logs
          $('<input type="hidden" value="' + news[trialOrder[i]].orig_index +'" name="orig_index'+ trialOrder[i] + '"></input>'),
          $('<input type="hidden" value="" id="startTimeID' + trialOrder[i] +'" name="startTime'+ trialOrder[i] + '"></input>'),
          $('<input type="hidden" value="" id="realFakeTimeID' + trialOrder[i] +'" name="realFakeTime'+ trialOrder[i] + '"></input>'),
          $('<input type="hidden" value="" id="confidenceTimeID' + trialOrder[i] +'" name="confidenceTime'+ trialOrder[i] + '"></input>'),
          $('<input type="hidden" value="" id="estimationTimeID' + trialOrder[i] +'" name="estimationTime'+ trialOrder[i] + '"></input>'),
          $('<input type="hidden" value="" id="validationTimeID' + trialOrder[i] +'" name="validationTime'+ trialOrder[i] + '"></input>'),
          // Reaction time per question
          $('<input type="hidden" value="" id="reactionTimeID' + trialOrder[i] +'" name="reactionTimeAnswer'+ trialOrder[i] + '"></input>'),
          $('<button type="button" class="nextQuestionButton" style="margin: 0 auto;"> Next </input>'),
          // $('<p align="right"> Question {0}/{1} </p>'.f(i+1, nTrials))
      )
    );
	//  Record Reaction Times
	addLogEvent(i);
  }

 
/* Wait for clicks */
$('#startExperiment').click(showFirstTrial);
$('.nextQuestionButton').click(buttonClicked);


});
</script>

</body>
</html>

<!-- do not put this on turk -->
<!-- <input type="submit" id="submitButton"> -->